<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="gift_products_description" inherit_id="website_sale.product_custom_text" active="True" customize_show="True" name="Gift description">
        <xpath expr="//div[@id='product_details']" position="inside">
            <t t-if='product.website_gift_active'>
                <div class="badge badge-primary" style="font-size: 100%!important;white-space: inherit">
                    <span>Gift wrapping is available on this product. Add product in cart to see wrapping options.</span>
                </div>
            </t>
        </xpath>
    </template>

    <template id="gift_website_sale_cart_lines" inherit_id="website_sale.cart_lines" name="Gift Shopping Cart Lines">
        <xpath expr="//td[hasclass('td-product_name')]" position="inside">
            <t t-if='line.product_id.website_gift_active and not line.gift_line_ids'>
                <div>
                    <a t-att-id="str(line.product_id.id)" role="button" class="js_gift_wrap_product btn btn-primary d-xl-inline-block" href="#">
                        <span class="">Gift wrap</span>
                    </a>
                </div>
                <div t-att-id="'hidden_box_' + str(line.product_id.id)" class="modal fade">
                    <div class="modal-dialog modal-content" style="height: auto!important; max-width:400px;">
                        <div class="modal-body" id="pop_html">
                            <a href="#" class="o_popup_btn_close o_not_editable o_default_snippet_text pull-right" data-dismiss="modal" style="font-size:30px">
                                Ã—
                            </a>
                            <br/>
                            <h2 style="text-align:center; font-size 24px; font-weight:bold" class="o_default_snippet_text">Gift wrap</h2>

                            <form action="/shop/cart/update_gift" method="POST">
                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />
                                <div t-att-id="'gift-product-data_' + str(line.product_id.id)" align="center">
                                    <t t-foreach="line.product_id.filter_gifts(website._get_warehouse_available())" t-as="gift_id">
                                        <div class="row mb8 cart_line">
                                            <div class="col-3 text-center">
                                                <span t-field="gift_id['gift_id'].image_128" t-options="{'widget': 'image', 'qweb_img_responsive': False, 'class': 'rounded o_image_64_max mb-2'}" />
                                            </div>
                                            <div class="col-9">
                                                <div>
                                                    <span class="h6" t-esc="gift_id['gift_id'].name"/>
                                                </div>
                                                <t t-if="gift_id['error']">
                                                    No available <input style="display:none;" type="number" value="0" min="0" t-att-id="gift_id['gift_id'].id" class="gift-qty form-control text-center"/>
                                                </t>
                                                <t t-else="">
                                                    <div>
                                                        Quantity: <input type="number" value="0" min="0" t-att-id="gift_id['gift_id'].id" class="gift-qty form-control text-center"/>
                                                    </div>
                                                </t>
                                            </div>
                                        </div>
                                    </t>
                                </div>
                                <div align="center" style="margin-top:15px">
                                    <a role="button" id="add_gift" t-att-data="'button-gift_' + str(line.product_id.id)" class="btn btn-primary btn-lg mt16 js_check_product a-submit d-block d-sm-inline-block" href="#"><i class="fa fa-shopping-cart"/> Add to Cart</a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </t>
        </xpath>
        <xpath expr="//div[hasclass('css_quantity')]" position="replace">
            <t t-if='line.is_gift'>
                <div style="display:none;">
                    <input type="text" class="js_quantity form-control quantity" t-att-data-line-id="line.id" t-att-data-product-id="line.product_id.id" t-att-value="int(line.product_uom_qty) == line.product_uom_qty and int(line.product_uom_qty) or line.product_uom_qty" />
                </div>
                <span class="js_quantity text-muted" t-esc="int(line.product_uom_qty)"/>
            </t>
            <t t-else="">
                <div class="css_quantity input-group mx-auto">
                    <div class="input-group-prepend">
                        <a t-attf-href="#" class="btn btn-link js_add_cart_json d-none d-md-inline-block" aria-label="Remove one" title="Remove one">
                            <i class="fa fa-minus"></i>
                        </a>
                    </div>
                    <input type="text" class="js_quantity form-control quantity" t-att-data-line-id="line.id" t-att-data-product-id="line.product_id.id" t-att-value="int(line.product_uom_qty) == line.product_uom_qty and int(line.product_uom_qty) or line.product_uom_qty" />
                    <div class="input-group-append">
                        <a t-attf-href="#" class="btn btn-link float_left js_add_cart_json d-none d-md-inline-block" aria-label="Add one" title="Add one">
                            <i class="fa fa-plus"></i>
                        </a>
                    </div>
                </div>
            </t>
        </xpath>
    </template>

</odoo>